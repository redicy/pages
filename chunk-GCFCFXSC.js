import{b as K,d as j,e as I,g as Y}from"./chunk-2T6NNSQE.js";import{F as w,Z as g,a as S,aa as U,b as y,ba as k,j as N,n as d,r as R,s as E,x as p}from"./chunk-TGGQRBPQ.js";var m;(function(c){c.SECURITY_TOKEN_SERVICE_URL=new U("SECURITY_TOKEN_SERVICE_URL");let o=(()=>{let e=class e{constructor(i,r){this.jsonParseReviver=void 0,this.http=i,this.baseUrl=r??"/"}generateToken(i){let r=this.baseUrl+"/Login";r=r.replace(/[?&]$/,"");let f={body:JSON.stringify(i),observe:"response",responseType:"blob",headers:new K({"Content-Type":"application/json",Accept:"application/json"})};return this.http.request("post",r,f).pipe(p(s=>this.processGenerateToken(s))).pipe(w(s=>{if(s instanceof j)try{return this.processGenerateToken(s)}catch(a){return E(a)}else return E(s)}))}processGenerateToken(i){let r=i.status,l=i instanceof I?i.body:i.error instanceof Blob?i.error:void 0,f={};if(i.headers)for(let s of i.headers.keys())f[s]=i.headers.get(s);return r===200?T(l).pipe(p(s=>{let a=null,O=s===""?null:JSON.parse(s,this.jsonParseReviver);return a=b.fromJS(O),R(a)})):r===503?T(l).pipe(p(s=>v("A server side error occurred.",r,s,f))):r!==200&&r!==204?T(l).pipe(p(s=>v("An unexpected server error occurred.",r,s,f))):R(null)}refreshToken(i){let r=this.baseUrl+"/Refresh";r=r.replace(/[?&]$/,"");let f={body:JSON.stringify(i),observe:"response",responseType:"blob",headers:new K({"Content-Type":"application/json",Accept:"application/json"})};return this.http.request("post",r,f).pipe(p(s=>this.processRefreshToken(s))).pipe(w(s=>{if(s instanceof j)try{return this.processRefreshToken(s)}catch(a){return E(a)}else return E(s)}))}processRefreshToken(i){let r=i.status,l=i instanceof I?i.body:i.error instanceof Blob?i.error:void 0,f={};if(i.headers)for(let s of i.headers.keys())f[s]=i.headers.get(s);return r===200?T(l).pipe(p(s=>{let a=null,O=s===""?null:JSON.parse(s,this.jsonParseReviver);return a=b.fromJS(O),R(a)})):r===503?T(l).pipe(p(s=>v("A server side error occurred.",r,s,f))):r!==200&&r!==204?T(l).pipe(p(s=>v("An unexpected server error occurred.",r,s,f))):R(null)}};e.\u0275fac=function(r){return new(r||e)(k(Y),k(c.SECURITY_TOKEN_SERVICE_URL,8))},e.\u0275prov=g({token:e,factory:e.\u0275fac});let u=e;return u})();c.TokenClient=o;class b{constructor(e){if(e)for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t])}init(e){if(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);this.accessToken=e.AccessToken,this.refreshToken=e.RefreshToken}}static fromJS(e){e=typeof e=="object"?e:{};let t=new b;return t.init(e),t}toJSON(e){e=typeof e=="object"?e:{};for(var t in this)this.hasOwnProperty(t)&&(e[t]=this[t]);return e.AccessToken=this.accessToken,e.RefreshToken=this.refreshToken,e}}c.JwtToken=b;class n{constructor(e){if(e)for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t])}init(e){if(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);this.login=e.Login,this.password=e.Password}}static fromJS(e){e=typeof e=="object"?e:{};let t=new n;return t.init(e),t}toJSON(e){e=typeof e=="object"?e:{};for(var t in this)this.hasOwnProperty(t)&&(e[t]=this[t]);return e.Login=this.login,e.Password=this.password,e}}c.LoginModel=n;class h extends Error{constructor(e,t,i,r,l){super(),this.isApiException=!0,this.message=e,this.status=t,this.response=i,this.headers=r,this.result=l}static isApiException(e){return e.isApiException===!0}}c.ApiException=h;function v(u,e,t,i,r){return r!=null?E(r):E(new h(u,e,t,i,null))}function T(u){return new N(e=>{if(!u)e.next(""),e.complete();else{let t=new FileReader;t.onload=i=>{e.next(i.target.result),e.complete()},t.readAsText(u)}})}})(m||(m={}));var M=(()=>{let o=class o{constructor(n){this.tokenClient=n}login(n,h){return this.tokenClient.generateToken(new m.LoginModel({login:n,password:h}))}refreshToken(n){return this.tokenClient.refreshToken(n)}};o.\u0275fac=function(h){return new(h||o)(k(m.TokenClient))},o.\u0275prov=g({token:o,factory:o.\u0275fac,providedIn:"root"});let c=o;return c})();var V=(()=>{let o=class o{constructor(){this.TOKEN_KEY="Auth.AccessToken",this.REFRESHTOKEN_KEY="Auth.RefreshToken",this.USER_KEY="Auth.UserData",this.storage=localStorage,this._loginSubject=new d(!!this.storage.getItem(this.TOKEN_KEY))}get isLoggedIn(){return this._loginSubject.value}signOut(){this._loginSubject.next(!1),[this.TOKEN_KEY,this.REFRESHTOKEN_KEY,this.USER_KEY].forEach(n=>this.storage.removeItem(n))}saveToken(n){this.storage.setItem(this.TOKEN_KEY,n);let h=this.getUser();h.id&&this.saveUser(y(S({},h),{accessToken:n})),this._loginSubject.next(!0)}getToken(){return this.storage.getItem(this.TOKEN_KEY)}saveRefreshToken(n){this.storage.removeItem(this.REFRESHTOKEN_KEY),this.storage.setItem(this.REFRESHTOKEN_KEY,n)}getRefreshToken(){return this.storage.getItem(this.REFRESHTOKEN_KEY)}saveUser(n){this.storage.removeItem(this.USER_KEY),this.storage.setItem(this.USER_KEY,JSON.stringify(n))}getUser(){let n=this.storage.getItem(this.USER_KEY);return n?JSON.parse(n):{}}};o.\u0275fac=function(h){return new(h||o)},o.\u0275prov=g({token:o,factory:o.\u0275fac,providedIn:"root"});let c=o;return c})();export{V as a,m as b,M as c};
