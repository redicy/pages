"use strict";(self.webpackChunkseller=self.webpackChunkseller||[]).push([[476],{8476:(X,g,o)=>{o.r(g),o.d(g,{ShipmentModule:()=>V});var l=o(6814),m=o(6697),v=o(5861),T=o(5619),c=o(6306),d=o(6232),S=o(2181),M=o(2572),x=o(9773),A=o(9397),z=o(7494),h=o(4125),t=o(2029),F=o(6593),U=o(7700),Z=o(5219),D=o(2966),y=o(4104),b=o(707),u=o(9151);function K(n,p){1&n&&(t.TgZ(0,"tr")(1,"th",7),t._uU(2," \u0414\u0430\u0442\u0430 "),t._UZ(3,"p-sortIcon",8),t.qZA(),t.TgZ(4,"th"),t._uU(5,"\u0421\u0442\u0430\u0442\u0443\u0441"),t.qZA(),t.TgZ(6,"th"),t._uU(7,"\u0422\u043e\u0432\u0430\u0440\u044b"),t.qZA(),t._UZ(8,"th"),t.qZA(),t.TgZ(9,"tr"),t._UZ(10,"th")(11,"th"),t.TgZ(12,"th"),t._UZ(13,"p-columnFilter",9),t.qZA(),t._UZ(14,"th"),t.qZA()),2&n&&(t.xp6(13),t.Q6J("showMatchModes",!1)("showOperator",!1))}function w(n,p){if(1&n&&(t.TgZ(0,"li"),t._uU(1),t.qZA()),2&n){const e=p.$implicit;t.xp6(1),t.hij(" ",e.value.name," ")}}const C=function(n){return{id:n}},J=function(n){return["summary",n]},O=function(n){return["edit",n]};function E(n,p){if(1&n&&(t.TgZ(0,"tr")(1,"td"),t._uU(2),t.ALo(3,"date"),t.qZA(),t.TgZ(4,"td"),t._uU(5),t.qZA(),t.TgZ(6,"td")(7,"ul"),t.YNc(8,w,2,1,"li",10),t.ALo(9,"keyvalue"),t.qZA()(),t.TgZ(10,"td"),t._UZ(11,"p-button",11)(12,"p-button",12),t.qZA()()),2&n){const e=p.$implicit;t.xp6(2),t.Oqu(t.xi3(3,5,e.date,"y-MM-dd")),t.xp6(3),t.Oqu(e.status),t.xp6(3),t.Q6J("ngForOf",t.lcZ(9,8,e.products)),t.xp6(3),t.Q6J("routerLink",t.VKq(12,J,t.VKq(10,C,e.iD))),t.xp6(1),t.Q6J("routerLink",t.VKq(16,O,t.VKq(14,C,e.iD)))}}const W=function(){return{"min-width":"75rem"}},Y=function(){return[10,25,50]},j=function(){return["name","date"]};function N(n,p){if(1&n){const e=t.EpF();t.TgZ(0,"p-table",3,4),t.NdJ("rowsChange",function(s){t.CHM(e);const a=t.oxw();return t.KtG(a.filterModel.count=s)})("onLazyLoad",function(s){t.CHM(e);const a=t.oxw();return t.KtG(a.onDataLazyLoad(s))}),t.YNc(2,K,15,2,"ng-template",5),t.YNc(3,E,13,18,"ng-template",6),t.qZA()}if(2&n){const e=t.oxw();t.Q6J("value",null==e.data?null:e.data.items)("lazy",!0)("tableStyle",t.DdM(9,W))("paginator",!0)("rows",e.filterModel.count)("rowsPerPageOptions",t.DdM(10,Y))("totalRecords",null==e.data?null:e.data.totalCount)("loading",e.loading)("globalFilterFields",t.DdM(11,j))}}const P=function(){return["/shipment/edit"]},Q=[{path:"",component:(()=>{class n extends z.V{constructor(e,i,s,a,f){super(e),this.ozonWarehouseService=i,this.messageService=s,this.dbService=a,this.shipmentClient=f,this.findShipmentsSubject=new T.X(null),this.filterModel=new h.W.FindShipmentsModel({offset:0,count:10}),this.loading=!1}importShipments(){this.shipmentClient.updateShipments().pipe((0,c.K)(e=>(this.messageService.add({summary:"\u041e\u0448\u0438\u0431\u043a\u0430 \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u044f \u043e\u0442\u0433\u0440\u0443\u0437\u043e\u043a",severity:"error",detail:e}),d.E))).subscribe()}updateFilter(e){this.dbService.update("filters",{id:n.name,data:e}).pipe((0,c.K)(i=>(this.messageService.add({summary:"\u041e\u0448\u0438\u0431\u043a\u0430 \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u044f \u0444\u0438\u043b\u044c\u0442\u0440\u0430",severity:"error",detail:i}),d.E))).subscribe()}updateShipment(){var e=this;return(0,v.Z)(function*(){e.shipmentClient.updateShipments().pipe((0,c.K)(i=>(e.messageService.add({summary:"\u041e\u0448\u0438\u0431\u043a\u0430 \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u044f \u043e\u0442\u0433\u0440\u0443\u0437\u043e\u043a",severity:"error",detail:i}),d.E))).subscribe()})()}findShipments(e){var i=this;return(0,v.Z)(function*(){i.loading=!0,i.ozonWarehouseService.getWarehouses();const a=i.ozonWarehouseService.warehouses.pipe((0,S.h)(r=>!!r)),f=i.shipmentClient.findShipments(e).pipe((0,c.K)(r=>(i.messageService.add({summary:"\u041e\u0448\u0438\u0431\u043a\u0430 \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u044f \u043e\u0442\u0433\u0440\u0443\u0437\u043e\u043a",severity:"error",detail:r}),i.loading=!1,d.E)));(0,M.a)(a,f).subscribe(r=>{i.loading=!1;const R=r[0],G=r[1]?.items?r[1].items.map(L=>({date:L.date,warehouses:[...new Set(L.supplies?.map(H=>R.find($=>$.iD==H.ozonWarehouseID).name))]})):[];i.data={totalCount:r[1].totalCount,items:G},i.loading=!1})})()}onDataLazyLoad(e){this.filterModel.count=e.rows,this.filterModel.offset=e.first}ngOnInit(){this.titleService.setTitle("\u041e\u0442\u0433\u0440\u0443\u0437\u043a\u0438"),this.findShipmentsSubject.pipe((0,x.R)(this.destroyed),(0,S.h)(e=>!!e)).pipe((0,A.b)(e=>{this.updateFilter(e)})).subscribe(e=>{this.findShipments(e)}),this.dbService.getByID("filters",n.name).subscribe(e=>{e&&e.data&&(this.filterModel=e.data),this.findShipments(this.filterModel)})}static#t=this.\u0275fac=function(i){return new(i||n)(t.Y36(F.Dx),t.Y36(U.w),t.Y36(Z.ez),t.Y36(D.ys),t.Y36(h.W.ShipmentClient))};static#e=this.\u0275cmp=t.Xpm({type:n,selectors:[["app-shipment-list"]],features:[t.qOj],decls:8,vars:3,consts:[[3,"routerLink"],[3,"click"],["dataKey","iD",3,"value","lazy","tableStyle","paginator","rows","rowsPerPageOptions","totalRecords","loading","globalFilterFields","rowsChange","onLazyLoad",4,"ngIf"],["dataKey","iD",3,"value","lazy","tableStyle","paginator","rows","rowsPerPageOptions","totalRecords","loading","globalFilterFields","rowsChange","onLazyLoad"],["dataTable",""],["pTemplate","header"],["pTemplate","body"],["pSortableColumn","date"],["field","date"],["field","article","matchMode","containsKey",3,"showMatchModes","showOperator"],[4,"ngFor","ngForOf"],["icon","pi pi-dollar",3,"routerLink"],["icon","pi pi-pencil",3,"routerLink"]],template:function(i,s){1&i&&(t._UZ(0,"p-toast"),t.TgZ(1,"h1"),t._uU(2,"\u041e\u0442\u0433\u0440\u0443\u0437\u043a\u0438"),t.qZA(),t.TgZ(3,"p-button",0),t._uU(4,"\u041d\u043e\u0432\u0430\u044f"),t.qZA(),t.TgZ(5,"p-button",1),t.NdJ("click",function(){return s.importShipments()}),t._uU(6,"\u0418\u043c\u043f\u043e\u0440\u0442"),t.qZA(),t.YNc(7,N,4,12,"p-table",2)),2&i&&(t.xp6(3),t.Q6J("routerLink",t.DdM(2,P)),t.xp6(4),t.Q6J("ngIf",null==s.data?null:s.data.items))},dependencies:[l.sg,l.O5,m.rH,y.FN,Z.jx,b.zx,u.iA,u.lQ,u.fz,u.xl,l.uU,l.Nd]})}return n})()}];let B=(()=>{class n{static#t=this.\u0275fac=function(i){return new(i||n)};static#e=this.\u0275mod=t.oAB({type:n});static#n=this.\u0275inj=t.cJS({imports:[m.Bz.forChild(Q),m.Bz]})}return n})();var I=o(4963);let V=(()=>{class n{static#t=this.\u0275fac=function(i){return new(i||n)};static#e=this.\u0275mod=t.oAB({type:n});static#n=this.\u0275inj=t.cJS({providers:[h.W.ShipmentClient,I.f.WarehouseClient],imports:[l.ez,B,y.EV,b.hJ,u.U$]})}return n})()}}]);