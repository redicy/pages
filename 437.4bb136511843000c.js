"use strict";(self.webpackChunkseller=self.webpackChunkseller||[]).push([[437],{3437:($,v,s)=>{s.r(v),s.d(v,{ShipmentModule:()=>V});var l=s(6814),h=s(6697),S=s(5861),y=s(5619),u=s(6306),p=s(6232),Z=s(2181),M=s(2572),F=s(9773),x=s(9397),z=s(7494),m=s(4125),t=s(2029),A=s(6593),D=s(4963),f=s(5219);let U=(()=>{class n{constructor(e,i){this.productDataServiceClient=e,this.messageService=i,this.warehouses=new y.X(null)}getWarehouses(){return this.productDataServiceClient.getOzonWarehouses().pipe((0,u.K)(e=>(this.messageService.add({summary:"\u041e\u0448\u0438\u0431\u043a\u0430",severity:"error",detail:e}),p.E)))}static#t=this.\u0275fac=function(i){return new(i||n)(t.LFG(D.f.WarehouseClient),t.LFG(f.ez))};static#e=this.\u0275prov=t.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var w=s(2966),b=s(4104),C=s(707),c=s(9232);function K(n,d){1&n&&(t.TgZ(0,"tr")(1,"th",7),t._uU(2," \u0414\u0430\u0442\u0430 "),t._UZ(3,"p-sortIcon",8),t.qZA(),t.TgZ(4,"th"),t._uU(5,"\u0421\u0442\u0430\u0442\u0443\u0441"),t.qZA(),t.TgZ(6,"th"),t._uU(7,"\u0422\u043e\u0432\u0430\u0440\u044b"),t.qZA(),t._UZ(8,"th"),t.qZA(),t.TgZ(9,"tr"),t._UZ(10,"th")(11,"th"),t.TgZ(12,"th"),t._UZ(13,"p-columnFilter",9),t.qZA(),t._UZ(14,"th"),t.qZA()),2&n&&(t.xp6(13),t.Q6J("showMatchModes",!1)("showOperator",!1))}function O(n,d){if(1&n&&(t.TgZ(0,"li"),t._uU(1),t.qZA()),2&n){const e=d.$implicit;t.xp6(1),t.hij(" ",e.value.name," ")}}const L=function(n){return{id:n}},E=function(n){return["summary",n]},J=function(n){return["edit",n]};function W(n,d){if(1&n&&(t.TgZ(0,"tr")(1,"td"),t._uU(2),t.ALo(3,"date"),t.qZA(),t.TgZ(4,"td"),t._uU(5),t.qZA(),t.TgZ(6,"td")(7,"ul"),t.YNc(8,O,2,1,"li",10),t.ALo(9,"keyvalue"),t.qZA()(),t.TgZ(10,"td"),t._UZ(11,"p-button",11)(12,"p-button",12),t.qZA()()),2&n){const e=d.$implicit;t.xp6(2),t.Oqu(t.xi3(3,5,e.date,"y-MM-dd")),t.xp6(3),t.Oqu(e.status),t.xp6(3),t.Q6J("ngForOf",t.lcZ(9,8,e.products)),t.xp6(3),t.Q6J("routerLink",t.VKq(12,E,t.VKq(10,L,e.iD))),t.xp6(1),t.Q6J("routerLink",t.VKq(16,J,t.VKq(14,L,e.iD)))}}const Y=function(){return{"min-width":"75rem"}},j=function(){return[10,25,50]},N=function(){return["name","date"]};function P(n,d){if(1&n){const e=t.EpF();t.TgZ(0,"p-table",3,4),t.NdJ("rowsChange",function(o){t.CHM(e);const a=t.oxw();return t.KtG(a.filterModel.count=o)})("onLazyLoad",function(o){t.CHM(e);const a=t.oxw();return t.KtG(a.onDataLazyLoad(o))}),t.YNc(2,K,15,2,"ng-template",5),t.YNc(3,W,13,18,"ng-template",6),t.qZA()}if(2&n){const e=t.oxw();t.Q6J("value",null==e.data?null:e.data.items)("lazy",!0)("tableStyle",t.DdM(9,Y))("paginator",!0)("rows",e.filterModel.count)("rowsPerPageOptions",t.DdM(10,j))("totalRecords",null==e.data?null:e.data.totalCount)("loading",e.loading)("globalFilterFields",t.DdM(11,N))}}const Q=function(){return["/shipment/edit"]},B=[{path:"",component:(()=>{class n extends z.V{constructor(e,i,o,a,g){super(e),this.ozonWarehouseService=i,this.messageService=o,this.dbService=a,this.shipmentClient=g,this.findShipmentsSubject=new y.X(null),this.filterModel=new m.W.FindShipmentsModel({offset:0,count:10}),this.loading=!1}importShipments(){this.shipmentClient.updateShipments().pipe((0,u.K)(e=>(this.messageService.add({summary:"\u041e\u0448\u0438\u0431\u043a\u0430 \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u044f \u043e\u0442\u0433\u0440\u0443\u0437\u043e\u043a",severity:"error",detail:e}),p.E))).subscribe()}updateFilter(e){this.dbService.update("filters",{id:n.name,data:e}).pipe((0,u.K)(i=>(this.messageService.add({summary:"\u041e\u0448\u0438\u0431\u043a\u0430 \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u044f \u0444\u0438\u043b\u044c\u0442\u0440\u0430",severity:"error",detail:i}),p.E))).subscribe()}updateShipment(){var e=this;return(0,S.Z)(function*(){e.shipmentClient.updateShipments().pipe((0,u.K)(i=>(e.messageService.add({summary:"\u041e\u0448\u0438\u0431\u043a\u0430 \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u044f \u043e\u0442\u0433\u0440\u0443\u0437\u043e\u043a",severity:"error",detail:i}),p.E))).subscribe()})()}findShipments(e){var i=this;return(0,S.Z)(function*(){i.loading=!0,i.ozonWarehouseService.getWarehouses();const a=i.ozonWarehouseService.warehouses.pipe((0,Z.h)(r=>!!r)),g=i.shipmentClient.findShipments(e).pipe((0,u.K)(r=>(i.messageService.add({summary:"\u041e\u0448\u0438\u0431\u043a\u0430 \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u044f \u043e\u0442\u0433\u0440\u0443\u0437\u043e\u043a",severity:"error",detail:r}),i.loading=!1,p.E)));(0,M.a)(a,g).subscribe(r=>{i.loading=!1;const G=r[0],R=r[1]?.items?r[1].items.map(T=>({date:T.date,warehouses:[...new Set(T.supplies?.map(H=>G.find(X=>X.iD==H.ozonWarehouseID).name))]})):[];i.data={totalCount:r[1].totalCount,items:R},i.loading=!1})})()}onDataLazyLoad(e){this.filterModel.count=e.rows,this.filterModel.offset=e.first}ngOnInit(){this.titleService.setTitle("\u041e\u0442\u0433\u0440\u0443\u0437\u043a\u0438"),this.findShipmentsSubject.pipe((0,F.R)(this.destroyed),(0,Z.h)(e=>!!e)).pipe((0,x.b)(e=>{this.updateFilter(e)})).subscribe(e=>{this.findShipments(e)}),this.dbService.getByID("filters",n.name).subscribe(e=>{e&&e.data&&(this.filterModel=e.data),this.findShipments(this.filterModel)})}static#t=this.\u0275fac=function(i){return new(i||n)(t.Y36(A.Dx),t.Y36(U),t.Y36(f.ez),t.Y36(w.ys),t.Y36(m.W.ShipmentClient))};static#e=this.\u0275cmp=t.Xpm({type:n,selectors:[["app-shipment-list"]],features:[t.qOj],decls:8,vars:3,consts:[[3,"routerLink"],[3,"click"],["dataKey","iD",3,"value","lazy","tableStyle","paginator","rows","rowsPerPageOptions","totalRecords","loading","globalFilterFields","rowsChange","onLazyLoad",4,"ngIf"],["dataKey","iD",3,"value","lazy","tableStyle","paginator","rows","rowsPerPageOptions","totalRecords","loading","globalFilterFields","rowsChange","onLazyLoad"],["dataTable",""],["pTemplate","header"],["pTemplate","body"],["pSortableColumn","date"],["field","date"],["field","article","matchMode","containsKey",3,"showMatchModes","showOperator"],[4,"ngFor","ngForOf"],["icon","pi pi-dollar",3,"routerLink"],["icon","pi pi-pencil",3,"routerLink"]],template:function(i,o){1&i&&(t._UZ(0,"p-toast"),t.TgZ(1,"h1"),t._uU(2,"\u041e\u0442\u0433\u0440\u0443\u0437\u043a\u0438"),t.qZA(),t.TgZ(3,"p-button",0),t._uU(4,"\u041d\u043e\u0432\u0430\u044f"),t.qZA(),t.TgZ(5,"p-button",1),t.NdJ("click",function(){return o.importShipments()}),t._uU(6,"\u0418\u043c\u043f\u043e\u0440\u0442"),t.qZA(),t.YNc(7,P,4,12,"p-table",2)),2&i&&(t.xp6(3),t.Q6J("routerLink",t.DdM(2,Q)),t.xp6(4),t.Q6J("ngIf",null==o.data?null:o.data.items))},dependencies:[l.sg,l.O5,h.rH,b.FN,f.jx,C.zx,c.iA,c.lQ,c.fz,c.xl,l.uU,l.Nd]})}return n})()}];let I=(()=>{class n{static#t=this.\u0275fac=function(i){return new(i||n)};static#e=this.\u0275mod=t.oAB({type:n});static#n=this.\u0275inj=t.cJS({imports:[h.Bz.forChild(B),h.Bz]})}return n})(),V=(()=>{class n{static#t=this.\u0275fac=function(i){return new(i||n)};static#e=this.\u0275mod=t.oAB({type:n});static#n=this.\u0275inj=t.cJS({providers:[m.W.ShipmentClient],imports:[l.ez,I,b.EV,C.hJ,c.U$]})}return n})()}}]);