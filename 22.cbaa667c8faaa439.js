"use strict";(self.webpackChunkseller=self.webpackChunkseller||[]).push([[22],{1022:(Q,v,s)=>{s.r(v),s.d(v,{ShipmentModule:()=>N});var l=s(177),c=s(2115),S=s(467),M=s(4412),m=s(9437),d=s(983),g=s(5964),j=s(4572),E=s(6977),D=s(8141),R=s(2180),h=s(2276),t=s(4438),G=s(345),T=s(8805),y=s(5779),z=s(4238),b=s(9998),F=s(1141),u=s(544);const I=()=>["/shipment/edit"],w=()=>({"min-width":"75rem"}),$=()=>[10,25,50],W=()=>["name","date"],C=n=>({id:n}),X=n=>["summary",n],k=n=>["edit",n];function O(n,p){1&n&&(t.j41(0,"tr")(1,"th",7),t.EFF(2," \u0414\u0430\u0442\u0430 "),t.nrm(3,"p-sortIcon",8),t.k0s(),t.j41(4,"th"),t.EFF(5,"\u0421\u0442\u0430\u0442\u0443\u0441"),t.k0s(),t.j41(6,"th"),t.EFF(7,"\u0422\u043e\u0432\u0430\u0440\u044b"),t.k0s(),t.nrm(8,"th"),t.k0s(),t.j41(9,"tr"),t.nrm(10,"th")(11,"th"),t.j41(12,"th"),t.nrm(13,"p-columnFilter",9),t.k0s(),t.nrm(14,"th"),t.k0s()),2&n&&(t.R7$(13),t.Y8G("showMatchModes",!1)("showOperator",!1))}function P(n,p){if(1&n&&(t.j41(0,"li"),t.EFF(1),t.k0s()),2&n){const e=p.$implicit;t.R7$(),t.SpI(" ",e.value.name," ")}}function U(n,p){if(1&n&&(t.j41(0,"tr")(1,"td"),t.EFF(2),t.nI1(3,"date"),t.k0s(),t.j41(4,"td"),t.EFF(5),t.k0s(),t.j41(6,"td")(7,"ul"),t.DNE(8,P,2,1,"li",10),t.nI1(9,"keyvalue"),t.k0s()(),t.j41(10,"td"),t.nrm(11,"p-button",11)(12,"p-button",12),t.k0s()()),2&n){const e=p.$implicit;t.R7$(2),t.JRh(t.i5U(3,5,e.date,"y-MM-dd")),t.R7$(3),t.JRh(e.status),t.R7$(3),t.Y8G("ngForOf",t.bMT(9,8,e.products)),t.R7$(3),t.Y8G("routerLink",t.eq3(12,X,t.eq3(10,C,e.iD))),t.R7$(),t.Y8G("routerLink",t.eq3(16,k,t.eq3(14,C,e.iD)))}}function Y(n,p){if(1&n){const e=t.RV6();t.j41(0,"p-table",4,0),t.mxI("rowsChange",function(o){t.eBV(e);const a=t.XpG();return t.DH7(a.filterModel.count,o)||(a.filterModel.count=o),t.Njj(o)}),t.bIt("onLazyLoad",function(o){t.eBV(e);const a=t.XpG();return t.Njj(a.onDataLazyLoad(o))}),t.DNE(2,O,15,2,"ng-template",5)(3,U,13,18,"ng-template",6),t.k0s()}if(2&n){const e=t.XpG();t.Y8G("value",null==e.data?null:e.data.items)("lazy",!0)("tableStyle",t.lJ4(9,w))("paginator",!0),t.R50("rows",e.filterModel.count),t.Y8G("rowsPerPageOptions",t.lJ4(10,$))("totalRecords",null==e.data?null:e.data.totalCount)("loading",e.loading)("globalFilterFields",t.lJ4(11,W))}}const x=[{path:"",component:(()=>{class n extends R.x{constructor(e,i,o,a,f){super(e),this.ozonWarehouseService=i,this.messageService=o,this.dbService=a,this.shipmentClient=f,this.findShipmentsSubject=new M.t(null),this.filterModel=new h.q.FindShipmentsModel({offset:0,count:10}),this.loading=!1}importShipments(){this.shipmentClient.updateShipments().pipe((0,m.W)(e=>(this.messageService.add({summary:"\u041e\u0448\u0438\u0431\u043a\u0430 \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u044f \u043e\u0442\u0433\u0440\u0443\u0437\u043e\u043a",severity:"error",detail:e}),d.w))).subscribe()}updateFilter(e){this.dbService.update("filters",{id:n.name,data:e}).pipe((0,m.W)(i=>(this.messageService.add({summary:"\u041e\u0448\u0438\u0431\u043a\u0430 \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u044f \u0444\u0438\u043b\u044c\u0442\u0440\u0430",severity:"error",detail:i}),d.w))).subscribe()}updateShipment(){var e=this;return(0,S.A)(function*(){e.shipmentClient.updateShipments().pipe((0,m.W)(i=>(e.messageService.add({summary:"\u041e\u0448\u0438\u0431\u043a\u0430 \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u044f \u043e\u0442\u0433\u0440\u0443\u0437\u043e\u043a",severity:"error",detail:i}),d.w))).subscribe()})()}findShipments(e){var i=this;return(0,S.A)(function*(){i.loading=!0,i.ozonWarehouseService.getWarehouses(!1,!1);const a=i.ozonWarehouseService.warehouses.pipe((0,g.p)(r=>!!r)),f=i.shipmentClient.findShipments(e).pipe((0,m.W)(r=>(i.messageService.add({summary:"\u041e\u0448\u0438\u0431\u043a\u0430 \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u044f \u043e\u0442\u0433\u0440\u0443\u0437\u043e\u043a",severity:"error",detail:r}),i.loading=!1,d.w)));(0,j.z)(a,f).subscribe(r=>{i.loading=!1;const V=r[0],A=r[1]?.items?r[1].items.map(L=>({date:L.date,warehouses:[...new Set(L.supplies?.map(K=>V.find(H=>H.iD==K.ozonWarehouseID).name))]})):[];i.data={totalCount:r[1].totalCount,items:A},i.loading=!1})})()}onDataLazyLoad(e){this.filterModel.count=e.rows,this.filterModel.offset=e.first}ngOnInit(){this.titleService.setTitle("\u041e\u0442\u0433\u0440\u0443\u0437\u043a\u0438"),this.findShipmentsSubject.pipe((0,E.Q)(this.destroyed),(0,g.p)(e=>!!e)).pipe((0,D.M)(e=>{this.updateFilter(e)})).subscribe(e=>{this.findShipments(e)}),this.dbService.getByID("filters",n.name).subscribe(e=>{e&&e.data&&(this.filterModel=e.data),this.findShipments(this.filterModel)})}static{this.\u0275fac=function(i){return new(i||n)(t.rXU(G.hE),t.rXU(T.t),t.rXU(y.bg),t.rXU(z.MX),t.rXU(h.q.ShipmentClient))}}static{this.\u0275cmp=t.VBU({type:n,selectors:[["app-shipment-list"]],features:[t.Vt3],decls:8,vars:3,consts:[["dataTable",""],[3,"routerLink"],[3,"click"],["dataKey","iD",3,"value","lazy","tableStyle","paginator","rows","rowsPerPageOptions","totalRecords","loading","globalFilterFields","rowsChange","onLazyLoad",4,"ngIf"],["dataKey","iD",3,"rowsChange","onLazyLoad","value","lazy","tableStyle","paginator","rows","rowsPerPageOptions","totalRecords","loading","globalFilterFields"],["pTemplate","header"],["pTemplate","body"],["pSortableColumn","date"],["field","date"],["field","article","matchMode","containsKey",3,"showMatchModes","showOperator"],[4,"ngFor","ngForOf"],["icon","pi pi-dollar",3,"routerLink"],["icon","pi pi-pencil",3,"routerLink"]],template:function(i,o){1&i&&(t.nrm(0,"p-toast"),t.j41(1,"h1"),t.EFF(2,"\u041e\u0442\u0433\u0440\u0443\u0437\u043a\u0438"),t.k0s(),t.j41(3,"p-button",1),t.EFF(4,"\u041d\u043e\u0432\u0430\u044f"),t.k0s(),t.j41(5,"p-button",2),t.bIt("click",function(){return o.importShipments()}),t.EFF(6,"\u0418\u043c\u043f\u043e\u0440\u0442"),t.k0s(),t.DNE(7,Y,4,12,"p-table",3)),2&i&&(t.R7$(3),t.Y8G("routerLink",t.lJ4(2,I)),t.R7$(4),t.Y8G("ngIf",null==o.data?null:o.data.items))},dependencies:[l.Sq,l.bT,c.Wk,b.y8,y.Ei,F.$n,u.XI,u.Tg,u.yc,u.rl,l.vh,l.lG]})}}return n})()}];let B=(()=>{class n{static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275mod=t.$C({type:n})}static{this.\u0275inj=t.G2t({imports:[c.iI.forChild(x),c.iI]})}}return n})();var J=s(4153);let N=(()=>{class n{static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275mod=t.$C({type:n})}static{this.\u0275inj=t.G2t({providers:[h.q.ShipmentClient,J.D.WarehouseClient],imports:[l.MD,B,b.MB,F.tm,u.bG]})}}return n})()}}]);