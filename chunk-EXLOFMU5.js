import{b as de,c as h}from"./chunk-W7QZIGU5.js";import{A as ae,I as se,J as le,K as pe,L as me,M as ue,N as ce,x as oe,z as re}from"./chunk-JP4EWZ2D.js";import{l as ne}from"./chunk-SXV73A3U.js";import"./chunk-6QOQO26M.js";import{Aa as te,Ba as ie,Y as ee}from"./chunk-VRSCPQJT.js";import{C as X,H as Z,N as $,S as z,q as G,r as H,y as J,z as Q}from"./chunk-OFWGRITY.js";import{Ab as u,Ac as D,Bb as a,Bc as Y,Cb as r,Cc as q,Db as c,E as x,Ec as T,F as S,Kb as R,Ob as E,Pb as w,Ta as p,U as B,V as O,_ as b,bc as m,cb as d,cc as I,dc as V,g as L,gc as K,hb as W,hc as A,ia as F,ib as v,ic as U,ja as M,lb as N,n as k,nb as C,o as f,qc as _,rc as g,w as P}from"./chunk-TGGQRBPQ.js";var Ce=()=>["/shipment/edit"],we=()=>({"min-width":"75rem"}),Le=()=>[10,25,50],xe=()=>["name","date"],he=t=>({id:t}),Fe=t=>["summary",t],Me=t=>["edit",t];function Ee(t,e){t&1&&(a(0,"tr")(1,"th",7),m(2," \u0414\u0430\u0442\u0430 "),c(3,"p-sortIcon",8),r(),a(4,"th"),m(5,"\u0421\u0442\u0430\u0442\u0443\u0441"),r(),a(6,"th"),m(7,"\u0422\u043E\u0432\u0430\u0440\u044B"),r(),c(8,"th"),r(),a(9,"tr"),c(10,"th")(11,"th"),a(12,"th"),c(13,"p-columnFilter",9),r(),c(14,"th"),r()),t&2&&(p(13),u("showMatchModes",!1)("showOperator",!1))}function Ie(t,e){if(t&1&&(a(0,"li"),m(1),r()),t&2){let o=e.$implicit;p(),V(" ",o.value.name," ")}}function De(t,e){if(t&1&&(a(0,"tr")(1,"td"),m(2),D(3,"date"),r(),a(4,"td"),m(5),r(),a(6,"td")(7,"ul"),C(8,Ie,2,1,"li",10),D(9,"keyvalue"),r()(),a(10,"td"),c(11,"p-button",11)(12,"p-button",12),r()()),t&2){let o=e.$implicit;p(2),I(q(3,5,o.date,"y-MM-dd")),p(3),I(o.status),p(3),u("ngForOf",Y(9,8,o.products)),p(3),u("routerLink",g(12,Fe,g(10,he,o.iD))),p(),u("routerLink",g(16,Me,g(14,he,o.iD)))}}function Te(t,e){if(t&1){let o=R();a(0,"p-table",6,0),U("rowsChange",function(n){F(o);let s=w();return A(s.filterModel.count,n)||(s.filterModel.count=n),M(n)}),E("onLazyLoad",function(n){F(o);let s=w();return M(s.onDataLazyLoad(n))}),C(2,Ee,15,2,"ng-template",null,1,T)(4,De,13,18,"ng-template",null,2,T),r()}if(t&2){let o=w();u("value",o.data==null?null:o.data.items)("lazy",!0)("tableStyle",_(9,we))("paginator",!0),K("rows",o.filterModel.count),u("rowsPerPageOptions",_(10,Le))("totalRecords",o.data==null?null:o.data.totalCount)("loading",o.loading)("globalFilterFields",_(11,xe))}}var Se=(()=>{let e=class e extends ne{constructor(i,n,s,y,l){super(i),this.ozonWarehouseService=n,this.messageService=s,this.dbService=y,this.shipmentClient=l,this.findShipmentsSubject=new k(null),this.filterModel=new h.FindShipmentsModel({offset:0,count:10}),this.loading=!1}importShipments(){this.shipmentClient.updateShipments().pipe(S(i=>(this.messageService.add({summary:"\u041E\u0448\u0438\u0431\u043A\u0430 \u043E\u0431\u043D\u043E\u0432\u043B\u0435\u043D\u0438\u044F \u043E\u0442\u0433\u0440\u0443\u0437\u043E\u043A",severity:"error",detail:i}),f))).subscribe()}updateFilter(i){this.dbService.update("filters",{id:e.name,data:i}).pipe(S(n=>(this.messageService.add({summary:"\u041E\u0448\u0438\u0431\u043A\u0430 \u043E\u0431\u043D\u043E\u0432\u043B\u0435\u043D\u0438\u044F \u0444\u0438\u043B\u044C\u0442\u0440\u0430",severity:"error",detail:n}),f))).subscribe()}updateShipment(){return L(this,null,function*(){this.shipmentClient.updateShipments().pipe(S(i=>(this.messageService.add({summary:"\u041E\u0448\u0438\u0431\u043A\u0430 \u043E\u0431\u043D\u043E\u0432\u043B\u0435\u043D\u0438\u044F \u043E\u0442\u0433\u0440\u0443\u0437\u043E\u043A",severity:"error",detail:i}),f))).subscribe()})}findShipments(i){return L(this,null,function*(){this.loading=!0;let n=this.ozonWarehouseService.getWarehouses(!1,!1),s=this.ozonWarehouseService.warehouses.pipe(x(l=>!!l)),y=this.shipmentClient.findShipments(i).pipe(S(l=>(this.messageService.add({summary:"\u041E\u0448\u0438\u0431\u043A\u0430 \u043E\u0431\u043D\u043E\u0432\u043B\u0435\u043D\u0438\u044F \u043E\u0442\u0433\u0440\u0443\u0437\u043E\u043A",severity:"error",detail:l}),this.loading=!1,f)));P(s,y).subscribe(l=>{this.loading=!1;let ge=l[0],ye=l[1]?.items?l[1].items.map(j=>({date:j.date,warehouses:[...new Set(j.supplies?.map(be=>ge.find(ve=>ve.iD==be.ozonWarehouseID).name))]})):[];this.data={totalCount:l[1].totalCount,items:ye},this.loading=!1})})}onDataLazyLoad(i){this.filterModel.count=i.rows,this.filterModel.offset=i.first}ngOnInit(){this.titleService.setTitle("\u041E\u0442\u0433\u0440\u0443\u0437\u043A\u0438"),this.findShipmentsSubject.pipe(B(this.destroyed),x(i=>!!i)).pipe(O(i=>{this.updateFilter(i)})).subscribe(i=>{this.findShipments(i)}),this.dbService.getByID("filters",e.name).subscribe(i=>{i&&i.data&&(this.filterModel=i.data),this.findShipments(this.filterModel)})}};e.\u0275fac=function(n){return new(n||e)(d(Z),d(de),d(ee),d(ce),d(h.ShipmentClient))},e.\u0275cmp=W({type:e,selectors:[["app-shipment-list"]],standalone:!1,features:[N],decls:8,vars:3,consts:[["dataTable",""],["header",""],["body",""],[3,"routerLink"],[3,"click"],["dataKey","iD",3,"value","lazy","tableStyle","paginator","rows","rowsPerPageOptions","totalRecords","loading","globalFilterFields","rowsChange","onLazyLoad",4,"ngIf"],["dataKey","iD",3,"rowsChange","onLazyLoad","value","lazy","tableStyle","paginator","rows","rowsPerPageOptions","totalRecords","loading","globalFilterFields"],["pSortableColumn","date"],["field","date"],["field","article","matchMode","containsKey",3,"showMatchModes","showOperator"],[4,"ngFor","ngForOf"],["icon","pi pi-dollar",3,"routerLink"],["icon","pi pi-pencil",3,"routerLink"]],template:function(n,s){n&1&&(c(0,"p-toast"),a(1,"h1"),m(2,"\u041E\u0442\u0433\u0440\u0443\u0437\u043A\u0438"),r(),a(3,"p-button",3),m(4,"\u041D\u043E\u0432\u0430\u044F"),r(),a(5,"p-button",4),E("click",function(){return s.importShipments()}),m(6,"\u0418\u043C\u043F\u043E\u0440\u0442"),r(),C(7,Te,6,12,"p-table",5)),n&2&&(p(3),u("routerLink",_(2,Ce)),p(4),u("ngIf",s.data==null?null:s.data.items))},dependencies:[G,H,$,me,te,oe,re,ae,se,J,Q],encapsulation:2});let t=e;return t})();var ze=[{path:"",component:Se}],_e=(()=>{let e=class e{};e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=v({type:e}),e.\u0275inj=b({imports:[z.forChild(ze),z]});let t=e;return t})();var at=(()=>{let e=class e{};e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=v({type:e}),e.\u0275inj=b({providers:[h.ShipmentClient,pe.WarehouseClient],imports:[X,_e,ue,ie,le]});let t=e;return t})();export{at as ShipmentModule};
